# Микросервисы для profi.ru

## Описание

Этот проект представляет собой реализацию микросервисов для системы заказа услуг, спроектированной в рамках lab01. 
Реализованы два независимых микросервиса:

1. **Сервис пользователей** - управление пользователями и авторизация
2. **Сервис услуг** - управление услугами

## Особенности

- Микросервисная архитектура с разделением ответственности
- HTTP REST API с использованием FastAPI
- JWT-аутентификация (Bearer token)
- Отдельный endpoint для получения токена по логину/паролю
- Реализация GET/POST методов для всех сервисов
- Данные хранятся в памяти
- Предустановленный мастер-пользователь (admin/secret)
- OpenAPI спецификация
- Запуск через docker-compose

## Требования

- Python 3.9+
- FastAPI
- Docker и docker-compose

## Установка и запуск

### Запуск с помощью Docker

```bash
# Сборка и запуск контейнеров
docker-compose up -d
```

## Порты микросервисов

- **Сервис пользователей**: http://localhost:8000
- **Сервис услуг**: http://localhost:8001

## Документация API

- **Сервис пользователей**: http://localhost:8000/docs
- **Сервис услуг**: http://localhost:8001/docs

## API Endpoints

### Сервис пользователей

#### Аутентификация

- `POST /token` - Получение JWT токена по логину и паролю

#### Пользователи

- `POST /users/` - Создание нового пользователя
- `GET /users/` - Получение списка пользователей (требуется роль админа)
- `GET /users/{user_id}` - Получение информации о пользователе
- `GET /users/me/` - Получение информации о текущем пользователе
- `POST /validate-token` - Внутренний endpoint для проверки токена

### Сервис услуг

- `POST /services/` - Создание новой услуги (требуется аутентификация)
- `GET /services/` - Получение списка услуг
- `GET /services/{service_id}` - Получение информации об услуге
- `GET /services/specialist/{specialist_id}` - Получение услуг специалиста

## Тестовые учетные записи

- Администратор: `admin@example.com` / `secret`
- Специалист: `specialist@example.com` / `password123`
- Клиент: `customer@example.com` / `password123`

## Структура проекта

```
lab02/
├── docker-compose.yml      # Общий docker-compose для запуска микросервисов
│
├── user-service/           # Сервис пользователей
│   ├── main.py             # Основной файл приложения
│   ├── auth.py             # Модуль JWT аутентификации
│   ├── database.py         # Хранение данных в памяти
│   ├── models/             # Модели данных (Pydantic)
│   │   └── user.py         # Модели пользователей
│   ├── routes/             # Маршруты API
│   │   └── user_router.py  # Маршруты для пользователей
│   ├── Dockerfile          # Файл для сборки Docker образа
│   └── requirements.txt    # Зависимости проекта
│
└── service-service/        # Сервис услуг
    ├── main.py             # Основной файл приложения
    ├── auth.py             # Модуль проверки JWT токенов
    ├── database.py         # Хранение данных в памяти
    ├── models/             # Модели данных (Pydantic)
    │   └── service.py      # Модели услуг
    ├── routes/             # Маршруты API
    │   └── service_router.py  # Маршруты для услуг
    ├── Dockerfile          # Файл для сборки Docker образа
    └── requirements.txt    # Зависимости проекта
```

## Взаимодействие микросервисов

1. **Сервис пользователей** - независимый микросервис, отвечающий за управление пользователями и генерацию JWT токенов.

2. **Сервис услуг** - отвечает за управление услугами, для авторизации отправляет запрос к сервису пользователей для валидации JWT токена.

В этой архитектуре каждый микросервис имеет свою ответственность и может работать независимо от других сервисов, что обеспечивает масштабируемость и гибкость системы. 